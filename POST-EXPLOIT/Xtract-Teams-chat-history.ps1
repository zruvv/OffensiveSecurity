<#ï»¿
    .SYNOPSIS
        Extracts Microsoft Teams Chat History.

    .DESCRIPTION
        -  
        -  Run this locally and in the context of the local user


    .NOTES
        File Name: Xtract_Teams-chat-history.ps1
        Last Updated: 8/24/2021
        Author: Mike Wurz
#>

Write-host "
 __   ___                  _     _______                           _____ _           _      _    _ _     _                   
 \ \ / / |                | |   |__   __|                         / ____| |         | |    | |  | (_)   | |                  
  \ V /| |_ _ __ __ _  ___| |_     | | ___  __ _ _ __ ___  ___   | |    | |__   __ _| |_   | |__| |_ ___| |_ ___  _ __ _   _ 
   > < | __| '__/ _` |/ __| __|    | |/ _ \/ _` | '_ ` _ \/ __|  | |    | '_ \ / _` | __|  |  __  | / __| __/ _ \| '__| | | |
  / . \| |_| | | (_| | (__| |_     | |  __/ (_| | | | | | \__ \  | |____| | | | (_| | |_   | |  | | \__ \ |_ (_) | |  | |_| |
 /_/ \_\\__|_|  \__,_|\___|\__|    |_|\___|\__,_|_| |_| |_|___/   \_____|_| |_|\__,_|\__|  |_|  |_|_|___/\__\___/|_|   \__, |
                                                                                                                        __/ |
                                                                                                                       |___/ 
"
$name = (Get-ChildItem C:\Users).name
$firstString = "<div"
$secondString = "div>"

Foreach($user in $name){
$importPath = "C:\Users\$user\AppData\Roaming\Microsoft\Teams\IndexedDB\https_teams.microsoft.com_0.indexeddb.leveldb\*.log"
#$importPath = "$Env:AppData\Microsoft\Teams\IndexedDB\https_teams.microsoft.com_0.indexeddb.leveldb\*.log"
$text = Get-Content $importPath
$pattern = "(?<=$firstString).*?(?=$secondString)"

$output = [regex]::Matches($text,$pattern).value
$hash = @{} 
Write-Output "MS Teams History for $name"
Write-Output $output | %{if($hash.$_ -eq $null) { $_ }; $hash.$_ = 1}
}
